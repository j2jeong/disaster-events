<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌍 글로벌 재해 모니터링 시스템</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌍 글로벌 재해 모니터링 시스템</h1>
            <p>실시간 재해 발생 현황 및 시간별 분석 대시보드</p>
            <div id="lastUpdate" class="last-update">데이터 로딩 중...</div>
        </div>
        
        <div class="content">
            <!-- 시간 컨트롤 섹션 -->
            <div class="time-controls">
                <h3>⏰ 시간 필터링 & 애니메이션 재생</h3>
                <div class="time-slider-container">
                    <div class="slider-row">
                        <label>시간 범위:</label>
                        <input type="range" id="timeSlider" class="time-slider" min="0" max="100" value="100">
                        <span id="sliderValue">100%</span>
                    </div>
                    <div class="time-info">
                        <div>
                            <label>표시 기간:</label>
                            <span id="timeRange" class="time-display">전체 기간</span>
                        </div>
                        <div>
                            <label>현재 이벤트:</label>
                            <span id="currentEvents" class="time-display">0개</span>
                        </div>
                        <div class="play-controls">
                            <button id="playBtn" class="play-btn" onclick="toggleAnimation()">▶ 재생</button>
                            <button class="speed-btn" data-speed="1000" onclick="setAnimationSpeed(1000)">느림</button>
                            <button class="speed-btn active" data-speed="700" onclick="setAnimationSpeed(700)">보통</button>
                            <button class="speed-btn" data-speed="500" onclick="setAnimationSpeed(500)">빠름</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 위험 알림 -->
            <div id="riskAlert" class="risk-alert hidden">
                <h4>⚠️ 위험 예측 알림</h4>
                <p id="riskMessage"></p>
            </div>

            <!-- 로딩 인디케이터 -->
            <div id="loadingIndicator" class="loading">
                <div class="spinner"></div>
                <p>데이터를 불러오는 중...</p>
            </div>

            <!-- 에러 메시지 -->
            <div id="errorMessage" class="error-message hidden">
                <h4>⚠️ 데이터 로딩 실패</h4>
                <p>최신 데이터를 불러올 수 없습니다. 잠시 후 다시 시도해주세요.</p>
                <button onclick="loadDisasterData()" class="retry-btn">다시 시도</button>
            </div>

            <div class="controls">
                <button id="mapView" class="active" onclick="switchView('map')">🗺️ 지도 보기</button>
                <button id="tableView" onclick="switchView('table')">📊 테이블 보기</button>
                <button id="listView" onclick="switchView('list')">📋 이벤트 리스트</button>
                <button onclick="downloadExcel()">📊 Excel 다운로드</button>
                <button onclick="downloadCSV()">📄 CSV 다운로드</button>
                <button onclick="resetFilters()">🔄 필터 초기화</button>
                <button onclick="refreshData()" id="refreshBtn">🔄 새로고침</button>
            </div>

            <div class="stats" id="stats"></div>

            <div class="filters">
                <label>🌎 카테고리:</label>
                <select id="categoryFilter" onchange="filterData()">
                    <option value="">모든 카테고리</option>
                </select>
                
                <label>📅 날짜 범위:</label>
                <input type="date" id="startDate" onchange="filterData()">
                <input type="date" id="endDate" onchange="filterData()">

                <label>🔍 검색:</label>
                <input type="text" id="searchInput" placeholder="이벤트 제목 검색..." onkeyup="filterData()">
            </div>

            <div class="view-container">
                <div id="mapContainer">
                    <div id="map"></div>
                </div>
                <div id="tableContainer" class="hidden">
                    <div class="table-container">
                        <table id="eventsTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-column="event_id" onclick="sortTable('event_id')">ID</th>
                                    <th class="sortable" data-column="event_title" onclick="sortTable('event_title')">제목</th>
                                    <th class="sortable" data-column="event_category" onclick="sortTable('event_category')">카테고리</th>
                                    <th class="sortable" data-column="event_date" onclick="sortTable('event_date')">날짜</th>
                                    <th class="sortable" data-column="address" onclick="sortTable('address')">위치</th>
                                    <th class="sortable" data-column="latitude" onclick="sortTable('latitude')">위도</th>
                                    <th class="sortable" data-column="longitude" onclick="sortTable('longitude')">경도</th>
                                    <th>상세</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="listContainer" class="hidden">
                    <div class="event-list" id="eventList">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js?v=4"></script>
</body>
</html>